<div id="ticket_batches_list" class="mt-8">
  <% if event.ticket_batches.any? %>
    <div class="bg-white rounded-xl shadow-lg p-6">
      <h2 class="text-xl font-bold text-purple-700 mb-4">
        <%= current_user&.admin? ? t("events.ticket_batches_list.batches") : t("events.ticket_batches_list.available") %>
      </h2>
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm text-left">
          <thead>
            <tr class="bg-purple-100 text-purple-800 uppercase text-xs">
              <th class="px-4 py-3"><%= t("events.ticket_batches_list.count") %></th>
              <th class="px-4 py-3"><%= t("events.ticket_batches_list.price") %></th>
              <th class="px-4 py-3"><%= t("events.ticket_batches_list.sale_start") %></th>
              <th class="px-4 py-3"><%= t("events.ticket_batches_list.sale_end") %></th>
              <th class="px-4 py-3"><%= t("events.ticket_batches_list.status") %></th>
              <th class="px-4 py-3"><%= t("events.ticket_batches_list.actions") %></th>
            </tr>
          </thead>
          <tbody>
            <% event.ticket_batches.each do |batch| %>
              <tr id="<%= dom_id(batch) %>" class="border-b hover:bg-purple-50 transition">
                <td class="px-4 py-3 font-semibold"><%= batch.available_tickets %></td>
                <td class="px-4 py-3"><%= number_to_currency(batch.price, unit: "$", format: "%n %u") %></td>
                <td class="px-4 py-3"><%= batch.sale_start&.strftime("%d-%m-%Y %H:%M") %></td>
                <td class="px-4 py-3"><%= batch.sale_end&.strftime("%d-%m-%Y %H:%M") %></td>
                <td class="px-4 py-3">
                  <% current_time = Time.current %>
                  <% if batch.available_tickets <= 0 %>
                    <span class="inline-block bg-red-100 text-red-700 px-2 py-1 rounded text-xs font-semibold"><%= t("events.ticket_batches_list.sold_out") %></span>
                  <% elsif batch.sale_start > current_time %>
                    <span class="inline-block bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs font-semibold"><%= t("events.ticket_batches_list.waiting") %></span>
                  <% elsif batch.sale_end < current_time %>
                    <span class="inline-block bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs font-semibold"><%= t("events.ticket_batches_list.ended") %></span>
                  <% else %>
                    <span class="inline-block bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-semibold"><%= t("events.ticket_batches_list.active") %></span>
                  <% end %>
                </td>
                <td class="px-4 py-3">
                  <% if current_user&.admin? %>
                      <%= link_to t("events.ticket_batches_list.edit"),
                            edit_event_ticket_batch_path(event, batch),
                            data: { turbo_frame: "modal_frame" },
                            class: "text-yellow-700 hover:underline font-semibold mr-2" %>
                    <%= button_to t("events.ticket_batches_list.delete"),
                          event_ticket_batch_path(event, batch),
                          method: :delete,
                          form: { data: { turbo_confirm: t("events.ticket_batches_list.confirm_delete") } },
                          class: "text-red-700 hover:underline font-semibold" %>
                  <% else %>
                    <% if batch.available_tickets > 0 && batch.sale_start <= current_time && batch.sale_end >= current_time %>
                      <%= link_to t("events.ticket_batches_list.buy"), new_ticket_batch_order_path(event_id: event.id, ticket_batch_id: batch.id), class: "text-purple-700 hover:underline font-semibold" %>
                    <% elsif batch.available_tickets <= 0 %>
                      <span class="text-red-500"><%= t("events.ticket_batches_list.no_tickets") %></span>
                    <% elsif batch.sale_start > current_time %>
                      <span class="text-yellow-600"><%= t("events.ticket_batches_list.sale_starts") %> <%= batch.sale_start.strftime("%d.%m.%Y") %></span>
                    <% elsif batch.sale_end < current_time %>
                      <span class="text-gray-400"><%= t("events.ticket_batches_list.sale_ended") %></span>
                    <% end %>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <% if current_user&.admin? %>
        <div class="mt-4">
          <%= link_to t("events.ticket_batches_list.add_batch"), new_event_ticket_batch_path(event), data: { turbo_frame: "modal_frame" }, class: "px-4 py-2 rounded bg-purple-100 hover:bg-purple-200 text-purple-700 font-semibold transition" %>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="bg-blue-50 text-blue-700 rounded-xl p-6 mt-4">
      <% if current_user&.admin? %>
        <%= t("events.ticket_batches_list.no_batches_admin") %>
        <div class="mt-2">
          <%= link_to t("events.ticket_batches_list.add_batch"), new_event_ticket_batch_path(event), data: { turbo_frame: "modal_frame" }, class: "px-4 py-2 rounded bg-purple-100 hover:bg-purple-200 text-purple-700 font-semibold transition" %>
        </div>
      <% else %>
        <%= t("events.ticket_batches_list.no_batches") %>
      <% end %>
    </div>
  <% end %>
</div>
